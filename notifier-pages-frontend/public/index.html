<!DOCTYPE html>
<html lang="ko">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>On-Call Schedule</title>
Â  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: 'Inter', 'SF Pro Display', sans-serif;
Â  Â  Â  margin: 0;
Â  Â  Â  background-color: #f6f7f8;
Â  Â  Â  color: #333;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  min-height: 100vh;
Â  Â  Â  padding-bottom: 60px;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  .container {
Â  Â  Â  max-width: 450px;
Â  Â  Â  width: 100%;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  flex-grow: 1;
Â  Â  }
Â  Â  .header {
Â  Â  Â  padding: 15px 16px 10px 16px;
Â  Â  Â  position: sticky;
Â  Â  Â  top: 0;
Â  Â  Â  background-color: #f6f7f8;
Â  Â  Â  z-index: 10;
Â  Â  }
Â  Â  .header h1 {
Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  font-weight: 700;
Â  Â  Â  color: #101922;
Â  Â  Â  margin: 0 0 15px;
Â  Â  }
Â  Â  .month-selector {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  gap: 15px;
Â  Â  }
Â  Â  .month-selector .arrow {
Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  color: #6c757d;
Â  Â  }
Â  Â  .month-selector h2 {
Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #101922;
Â  Â  Â  margin: 0;
Â  Â  Â  cursor: pointer; /* âš›ï¸ ì—°ì† í´ë¦­ íŠ¸ë¦¬ê±°ë¥¼ ìœ„í•´ ì»¤ì„œ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
Â  Â  }
Â  Â  .schedule-list {
Â  Â  Â  padding: 0 16px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  .schedule-card {
Â  Â  Â  background-color: #ffffff;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);
Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  padding: 8px 18px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: space-between;
Â  Â  }Â  Â Â 
Â  Â  /* ì˜¤ëŠ˜ ë‚ ì§œ ì¹´ë“œ ê°•ì¡° */
Â  Â  .schedule-card.today {
Â  Â  Â  border: 2px solid #137fec;
Â  Â  Â  box-shadow: 0 2px 8px rgba(19, 127, 236, 0.2);
Â  Â  }Â  Â Â 
Â  Â  .card-date {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  width: 70px;
Â  Â  Â  position: relative;
Â  Â  }
Â  Â  .day-num {
Â  Â  Â  font-weight: 500;
Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  color: #101922;
Â  Â  }
Â  Â  .day-name {
Â  Â  Â  font-size: 0.95rem;
Â  Â  Â  color: #6c757d;
Â  Â  }
Â  Â  /* ì£¼ë§ ìƒ‰ìƒ */
Â  Â  .day-name.weekend-sat { color: #137fec; }
Â  Â  .day-name.weekend-sun { color: #dc3545; }
Â  Â  /* ê·¼ë¬´ íƒ€ì… ì•„ì´ì½˜ ìœ„ì¹˜ ì¡°ì • (ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬) */
Â  Â  .duty-icon {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 50%; /* ìƒë‹¨ 50% ìœ„ì¹˜ */
Â  Â  Â  transform: translateY(-50%); /* ì•„ì´ì½˜ ë†’ì´ì˜ 50%ë§Œí¼ ìœ„ë¡œ ì´ë™ */
Â  Â  Â  left: -2px; /* ì¢Œì¸¡ì—ì„œ ì¡°ê¸ˆ ìš°ì¸¡ìœ¼ë¡œ ì´ë™ */
Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  transition: color 0.2s;
Â  Â  }
Â  Â  .day-icon { left: 3px; color: #ffc107; }
Â  Â  .night-icon { left: 3px; color: #4a5482; }
Â  Â  .mixed-icon { left: 3px; color: #f96d00; }
Â  Â  /* ë‹¹ì§ì ì—´ ì •ë ¬ */
Â  Â  .card-duties {
Â  Â  Â  flex-grow: 1;
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  border-left: 1px solid #eee;
Â  Â  Â  padding-left: 1px; /* ì£¼ê°„ë‹¹ì§ìë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë„ìš°ê¸° */
Â  Â  Â  color: #555;
Â  Â  Â  font-size: 1.0rem;
Â  Â  }
Â  Â  .day-duty-col {
Â  Â  Â  flex: 4;
Â  Â  Â  text-align: center; /* ì£¼ê°„ ë‹¹ì§ì ì¤‘ì•™ ì •ë ¬ ìœ ì§€ */
Â  Â  Â  font-weight: 500;
Â  Â  }
Â  Â  .night-duty-col {
Â  Â  Â  flex: 6;
Â  Â  Â  text-align: center; /* ì•¼ê°„ ë‹¹ì§ìë¥¼ ì¤‘ì•™ìª½ìœ¼ë¡œ ì´ë™ */
Â  Â  Â  font-weight: 500;
Â  Â  }
Â  Â  /* ---------- Settings Modal / Toast / Footer ---------- */
Â  Â  #settings-modal {
Â  Â  Â  display: none; position: fixed; top: 0; left: 0;
Â  Â  Â  width: 100vw; height: 100vh;
Â  Â  Â  background: rgba(0, 0, 0, 0.45); backdrop-filter: blur(3px);
Â  Â  Â  justify-content: center; align-items: center; z-index: 1000;
Â  Â  Â  animation: fadeIn 0.25s ease-out;
Â  Â  }
Â  Â  #settings-modal .modal-content {
Â  Â  Â  background: #fff; border-radius: 18px; width: 92%; max-width: 380px;
Â  Â  Â  padding: 24px 20px; box-shadow: 0 8px 24px rgba(0,0,0,0.15);
Â  Â  Â  animation: scaleUp 0.25s ease-out; position: relative; text-align: left;
Â  Â  Â  box-sizing: border-box;
Â  Â  }
Â  Â  /* ... (Modal input, button styles) ... */
Â  Â  #settings-modal input {
Â  Â  Â  width: calc(100% - 4px); /* ğŸ’¡ width ìˆ˜ì • (íŒ¨ë”© ê³ ë ¤) */
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  padding: 9px 10px;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  border-radius: 8px; /* ë©”ì¸ ë””ìì¸ê³¼ í†µì¼ì„± */
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  background-color: #f7f8fa; /* ë°°ê²½ìƒ‰ì„ ì—°í•˜ê²Œ */
Â  Â  Â  margin-top: 20px;
Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  transition: all 0.2s;
Â  Â  }
Â  Â  #settings-modal input:focus {
Â  Â  Â  border-color: #137fec; /* í¬ì»¤ìŠ¤ ì‹œ ê°•ì¡° ìƒ‰ìƒ */
Â  Â  Â  background-color: #fff;
Â  Â  Â  outline: none;
Â  Â  }Â  Â Â 
Â  Â  .modal-buttons {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: flex-end; /* ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë°°ì¹˜ */
Â  Â  Â  gap: 10px;
Â  Â  Â  margin-top: 24px;
Â  Â  }
Â  Â  .button {
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px; /* ëª¨ì„œë¦¬ í†µì¼ */
Â  Â  Â  padding: 10px 16px;
Â  Â  Â  font-size: 0.95rem;
Â  Â  Â  font-weight: 600;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background 0.2s, transform 0.1s;
Â  Â  }
Â  Â  .button.save {
Â  Â  Â  background-color: #137fec; /* ë©”ì¸ ê°•ì¡° ìƒ‰ìƒ */
Â  Â  Â  color: #fff;
Â  Â  }
Â  Â  .button.cancel {
Â  Â  Â  background-color: #6c757d; /* íšŒìƒ‰ í†¤ */
Â  Â  Â  color: #fff;
Â  Â  }
Â  Â  /* í˜¸ë²„ íš¨ê³¼ (Mini Appì—ì„œëŠ” ì˜ ì‚¬ìš©ë˜ì§€ ì•Šì§€ë§Œ, ì›¹ë·° í‘œì¤€ì„ ìœ„í•´ ìœ ì§€) */
Â  Â  .button.save:hover { background-color: #0f6ed4; }
Â  Â  .button.cancel:hover { background-color: #5c636a; }
Â  Â  
Â  Â  /* Footer Nav */
Â  Â  .footer-nav {
Â  Â  Â  position: fixed;
Â  Â  Â  bottom: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  max-width: 450px;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  display: flex; /* âš›ï¸ FooterëŠ” í•­ìƒ flexë¡œ ìœ ì§€í•©ë‹ˆë‹¤. */
Â  Â  Â  justify-content: space-around;
Â  Â  Â  background-color: #fff;
Â  Â  Â  border-top: 1px solid #eee;
Â  Â  Â  box-shadow: 0 -1px 4px rgba(0, 0, 0, 0.05);
Â  Â  Â  z-index: 50;
Â  Â  }
Â  Â  
Â  Â  /* âš›ï¸ [START] ì„¤ì • ë²„íŠ¼ í† ê¸€ì„ ìœ„í•œ CSS ìˆ˜ì • */
Â  Â  .footer-nav-item {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  padding: 8px 0;
Â  Â  Â  text-decoration: none;
Â  Â  Â  color: #6c757d;
Â  Â  Â  font-size: 0.7rem;
Â  Â  Â  transition: flex 0.3s ease, width 0.3s ease; /* ì „í™˜ íš¨ê³¼ ì¶”ê°€ */
Â  Â  Â  overflow: hidden;
Â  Â  }

Â  Â  /* ê¸°ë³¸ ìƒíƒœ: Today(ì²« ë²ˆì§¸ ìš”ì†Œ)ëŠ” 100%ë¥¼ ì°¨ì§€ */
Â  Â  .footer-nav-item:nth-child(1) { /* Today ë²„íŠ¼ */
Â  Â  Â  flex: 1; /* ë‚¨ì€ ê³µê°„ ëª¨ë‘ ì°¨ì§€ */
Â  Â  }

Â  Â  /* ê¸°ë³¸ ìƒíƒœ: Settings(ë‘ ë²ˆì§¸ ìš”ì†Œ)ëŠ” ì™„ì „íˆ ìˆ¨ê¹€ */
Â  Â  .footer-nav-item:nth-child(2) { /* Settings ë²„íŠ¼ */
Â  Â  Â  display: none; /* Flexbox ë ˆì´ì•„ì›ƒì—ì„œ ì™„ì „íˆ ì œê±° */
Â  Â  Â  width: 0; /* í˜¹ì‹œ ëª¨ë¥¼ ë„ˆë¹„ë„ 0ìœ¼ë¡œ ì„¤ì • */
Â  Â  }

Â  Â  /* í™œì„±í™” ìƒíƒœ: footer-navì— .settings-active í´ë˜ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆì„ ë•Œ */
Â  Â  .footer-nav.settings-active .footer-nav-item:nth-child(1) { /* Today ë²„íŠ¼ */
Â  Â  Â  flex: 7; /* 70% ë¹„ìœ¨ */
Â  Â  }

Â  Â  .footer-nav.settings-active .footer-nav-item:nth-child(2) { /* Settings ë²„íŠ¼ */
Â  Â  Â  display: flex; /* ë³´ì´ê²Œ í•¨ */
Â  Â  Â  flex: 3; /* 30% ë¹„ìœ¨ */
Â  Â  Â  width: auto; /* ë„ˆë¹„ ìë™ ì„¤ì • */
Â  Â  }
Â  Â  /* âš›ï¸ [END] ì„¤ì • ë²„íŠ¼ í† ê¸€ì„ ìœ„í•œ CSS ìˆ˜ì • */


Â  Â  .footer-nav-item.active, .footer-nav-item:hover {
Â  Â  Â  color: #137fec;
Â  Â  }
Â  Â  .footer-nav-item span.material-icons {
Â  Â  Â  font-size: 1.4rem;
Â  Â  }
Â  Â  @keyframes fadeIn {
Â  Â  Â  from { opacity: 0; } to { opacity: 1; }
Â  Â  }
Â  Â  @keyframes scaleUp {
Â  Â  Â  from { transform: scale(0.95); opacity: 0.8; }
Â  Â  Â  to { transform: scale(1); opacity: 1; }
Â  Â  }
Â  Â Â 
Â  Â  /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ê°ì‹¸ëŠ” ê·¸ë£¹ì„ Flex ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¦ */
Â  Â  .icon-text-group {
Â  Â  Â  display: flex;Â  Â  Â  Â  Â /* ì´ ìš”ì†Œë¥¼ Flexbox ì»¨í…Œì´ë„ˆë¡œ ì„¤ì • */
Â  Â  Â  align-items: center;Â  Â /* ìì‹ ìš”ì†Œë“¤(ì•„ì´ì½˜, í…ìŠ¤íŠ¸)ì„ ì„¸ë¡œì¶•(êµì°¨ì¶•) ì¤‘ì•™ì— ì •ë ¬ */
Â  Â  Â  gap: 8px;Â  Â  Â  Â  Â  Â  Â  /* ìì‹ ìš”ì†Œë“¤ ì‚¬ì´ì— 8pxì˜ ê°„ê²© */
Â  Â  Â  margin-bottom: 5px;Â  Â  /* ë‹¤ìŒ ì…ë ¥ í•„ë“œì™€ì˜ ê°„ê²© ì¡°ì • (í•„ìš”ì‹œ) */
Â  Â  Â  /* H2ë‚˜ Labelì˜ ê¸°ë³¸ marginì´ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì´ˆê¸°í™” */
Â  Â  }
Â  Â  .icon-text-group h2,
Â  Â  .icon-text-group label {
Â  Â  Â  margin: 0;Â  Â  Â  Â  Â  Â  Â /* h2ì™€ labelì˜ ê¸°ë³¸ ë§ˆì§„ì„ ì—†ì• ì„œ flexbox ì •ë ¬ì— ë°©í•´ë˜ì§€ ì•Šë„ë¡ í•¨ */
Â  Â  Â  line-height: 1.2;Â  Â  Â  /* í…ìŠ¤íŠ¸ì˜ ë¼ì¸ ë†’ì´ ì¡°ì ˆ (ì·¨í–¥ì— ë”°ë¼) */
Â  Â  }

Â  Â  /* ì„¤ì • ì œëª© ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ê·¸ë£¹ (ì˜µì…˜) */
Â  Â  .icon-text-group.header-group {
Â  Â  Â  Â  /* í•„ìš”í•˜ë©´ ì„¤ì • ì œëª© ë¶€ë¶„ì—ë§Œ ì¶”ê°€ì ì¸ ìŠ¤íƒ€ì¼ ì ìš© ê°€ëŠ¥ */
Â  Â  Â  Â  margin-top: 10px; /* ìƒë‹¨ ì—¬ë°± ì¶”ê°€ ë“± */
Â  Â  }
Â  Â  #access-denied {
Â  Â  Â  display: none; /* ğŸ’¥ğŸ’¥ğŸ’¥ ì´ˆê¸°ì—ëŠ” display: none;ìœ¼ë¡œ ìˆ¨ê¹€ ğŸ’¥ğŸ’¥ğŸ’¥ */
Â  Â  Â  margin-top: 50px;Â 
Â  Â  Â  color: #dc3545;Â 
Â  Â  Â  font-weight:600;
Â  Â  }
Â  Â  #toast {
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  transform: translate(-50%, -50%);Â  Â  Â  Â Â 
Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.75);
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  padding: 12px 24px;
Â  Â  Â  Â  border-radius: 25px;
Â  Â  Â  Â  z-index: 1000;Â  Â  Â  Â Â 
Â  Â  Â  Â  /* ğŸ’¥ğŸ’¥ğŸ’¥ ì´ ìƒíƒœë¡œ ìœ ì§€! ğŸ’¥ğŸ’¥ğŸ’¥ */
Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  visibility: hidden;Â 
Â  Â  Â  Â  transition: opacity 1.0s ease-in-out;Â  Â  Â  Â  Â 
Â  Â  Â  Â  font-size: 1.0em;
Â  Â  Â  Â  white-space: nowrap;
Â  Â  }
Â  </style>
Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
Â  <div class="container">
Â  Â  <div class="header">
Â  Â  Â  <div class="month-selector">
Â  Â  Â  Â  <span class="arrow material-icons" onclick="prevMonth()">chevron_left</span>
Â  Â  Â  Â  <h2 id="current-month-year">2025ë…„ 10ì›”</h2> Â  Â  Â  Â  <span class="arrow material-icons" onclick="nextMonth()">chevron_right</span>
Â  Â  Â  </div>
Â  Â  </div>


Â  Â  <div id="telegram-info" style="padding: 16px; background: #eef; border-radius: 8px; margin: 16px; display: none;">
Â  Â  Â  Telegram WebApp ì •ë³´ ë¡œë”© ì¤‘...
Â  Â  </div>
Â  Â Â 
Â  Â  Â  Â  <div id="access-denied" margin-top: 50px; color: #dc3545; font-weight:600;">
Â  Â  Â  Â  Â  Â  <p>ì´ ë¯¸ë‹ˆì•±ì€ íŠ¹ì • í…”ë ˆê·¸ë¨ ë‹¨ì²´ë°© ë©¤ë²„ë§Œ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
Â  Â  </div>

Â  Â  <div id="main-content" class="schedule-list"></div>

Â  Â  <div id="settings-modal">
Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="icon-text-group"> Â  Â  Â  Â  Â  <span class="material-icons">wb_sunny</span>
Â  Â  Â  Â  Â  <label for="duty-cycle">ê·¼ë¬´ ì£¼ê¸° (ê³µë°±ìœ¼ë¡œ êµ¬ë¶„)</label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <input id="duty-cycle" type="text" placeholder="ì˜ˆ: ì£¼ ì£¼ ì•¼ ì•¼ ë¹„ ë¹„">

Â  Â  Â  Â  <div class="icon-text-group"> Â  Â  Â  Â  Â  <span class="material-icons">flag</span>
Â  Â  Â  Â  Â  <label for="duty-base-date">ê¸°ì¤€ì¼ (ì²« ë²ˆì§¸ ì£¼ê°„ ê·¼ë¬´ì¼)</label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <input id="duty-base-date" type="date">

Â  Â  Â  Â  <div class="icon-text-group"> Â  Â  Â  Â  Â  <span class="material-icons">group</span>
Â  Â  Â  Â  Â  <label for="duty-users">ê·¼ë¬´ì ëª…ë‹¨ (ê³µë°±ìœ¼ë¡œ êµ¬ë¶„)</label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <input id="duty-users" type="text" placeholder="ì˜ˆ: í™ê¸¸ë™ ê¹€ì² ìˆ˜ ì´ì˜í¬">

Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  <button class="button cancel" onclick="closeSettingsModal()">ë‹«ê¸°</button>
Â  Â  Â  Â  Â  <button class="button save" onclick="saveDutyCycle()">ì €ì¥</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div id="toast"></div>

Â  <footer class="footer-nav">
Â  Â  <a class="footer-nav-item" href="#" onclick="goToToday(); return false;">
Â  Â  Â  <span class="material-icons">today</span>
Â  Â  Â  <span>Today</span>
Â  Â  </a>
Â  Â  <a class="footer-nav-item" href="#" onclick="openSettingsModal(); return false;">
Â  Â  Â  <span class="material-icons">settings</span>
Â  Â  Â  <span>Settings</span>
Â  Â  </a>
Â  </footer>
Â Â 
Â  <script>
Â  Â  Â  const DAYS = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];Â 
Â  Â  Â  let currentDate = new Date();Â 
Â  Â  Â  const WORKER_API_BASE = 'https://notifier-worker-backend.annae0sang3.workers.dev';

Â  Â  Â  // =========================================================================
Â  Â  Â  // âœ… í…”ë ˆê·¸ë¨ WebApp ë° ì‚¬ìš©ì ê²€ì¦ ë¡œì§ (URL íŒŒë¼ë¯¸í„° ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½)
Â  Â  Â  // =========================================================================
Â  Â  Â  let currentUserId = null; // ğŸ’¥ ê²€ì¦ëœ ì‚¬ìš©ì IDë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
Â  Â  Â  let currentChatId = null; // ğŸ’¥ í˜„ì¬ ë¯¸ë‹ˆì•±ì´ ì—´ë¦° ì±„íŒ…ë°© ID ì €ì¥í•  ì „ì—­ ë³€ìˆ˜

Â  Â  Â  document.addEventListener('DOMContentLoaded', async () => {
Â  Â  Â  Â  console.log("DEBUG: DOMContentLoaded Start"); // âœ… ì´ ë¡œê·¸ê°€ ì½˜ì†”ì— ì°íˆëŠ”ì§€ í™•ì¸
Â  Â  Â  Â  Â  const headerElement = document.querySelector('.header');
Â  Â  Â  Â  Â  const mainContentElement = document.getElementById('main-content');
Â  Â  Â  Â  Â  const footerNavElement = document.querySelector('.footer-nav');
Â  Â  Â  Â  Â  const telegramInfoDiv = document.getElementById('telegram-info');
Â  Â  Â  Â  Â  const accessDeniedDiv = document.getElementById('access-denied');
Â  Â  Â  Â  Â  // ì´ˆê¸° UI ìˆ¨ê¸°ê¸°
Â  Â  Â  Â  Â  headerElement.style.display = 'none';
Â  Â  Â  Â  Â  mainContentElement.style.display = 'none';
Â  Â  Â  Â  Â  footerNavElement.style.display = 'none';
Â  Â  Â  Â  Â  telegramInfoDiv.style.display = 'none'; // ì´ˆê¸° ì •ë³´ì°½ë„ ìˆ¨ê¹€
Â  Â  Â  Â  Â  // í…”ë ˆê·¸ë¨ WebApp ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì—¬ë¶€ ë° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
Â  Â  Â  Â  Â  if (typeof Telegram === 'undefined' || !window.Telegram.WebApp) {
Â  Â  Â  Â  Â  Â  Â  console.log('âŒ í…”ë ˆê·¸ë¨ ë¯¸ë‹ˆì•± í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤. ì¼ë°˜ ì›¹í˜ì´ì§€ë¡œ ì—´ë ¸ìŠµë‹ˆë‹¤.');
Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.querySelector('p').textContent = 'ì´ ì•±ì€ í…”ë ˆê·¸ë¨ ë¯¸ë‹ˆì•± í™˜ê²½ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤.';
Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.style.display = 'block'; // ì ‘ê·¼ ê±°ë¶€ ë©”ì‹œì§€ í™œì„±í™”
Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  // í…”ë ˆê·¸ë¨ WebApp ì¤€ë¹„ ì™„ë£Œ ì•Œë¦¼
Â  Â  Â  Â  console.log("DEBUG: Telegram WebApp is ready to proceed."); // âœ… ì´ ë¡œê·¸ê°€ ì°íˆëŠ”ì§€ í™•ì¸
Â  Â  Â  Â  Â  window.Telegram.WebApp.ready();Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  // ğŸ’¥ğŸ’¥ğŸ’¥ URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ user_id, chat_id, sigë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤! ğŸ’¥ğŸ’¥ğŸ’¥
Â  Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  Â  const userId = urlParams.get('user_id');
Â  Â  Â  Â  Â  const chatId = urlParams.get('chat_id');
Â  Â  Â  Â  Â  const signature = urlParams.get('sig'); // ë³´ì•ˆ ì„œëª…
Â  Â  Â  Â  Â  console.log(`DEBUG_PARAMS: userId=${userId}, chatId=${chatId}, signature=${signature}`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const tg = window.Telegram.WebApp;
Â  Â  Â  Â  Â  console.log("initData:", tg.initData);
Â  Â  Â  Â  Â  console.log("initDataUnsafe:", tg.initDataUnsafe);Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  console.log(`DEBUG_PAGES_FETCH_URL: ${WORKER_API_BASE}/verify_params`);

Â  Â  Â  Â  Â  if (!userId || !chatId || !signature) {
Â  Â  Â  Â  Â  Â  Â  console.error('âŒ URL íŒŒë¼ë¯¸í„°ì— user_id, chat_id ë˜ëŠ” sigê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');
Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.querySelector('p').textContent = 'ì—ëŸ¬: í•„ìˆ˜ ì •ë³´ê°€ ëˆ„ë½ë˜ì–´ ì¸ì¦í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.style.display = 'block'; // ì ‘ê·¼ ê±°ë¶€ ë©”ì‹œì§€ í™œì„±í™”
Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  console.log(`URL Params from Frontend: userId=${userId}, chatId=${chatId}, signature=${signature}`);

Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  // ğŸ’¥ğŸ’¥ğŸ’¥ Pagesì—ì„œ Workersë¡œ ì „ì†¡í•  JSON ë°”ë””ë¥¼ ë¯¸ë¦¬ ì°ì–´ë´…ë‹ˆë‹¤. ğŸ’¥ğŸ’¥ğŸ’¥
Â  Â  Â  Â  Â  Â  Â  const bodyToSend = JSON.stringify({ userId, chatId, signature });
Â  Â  Â  Â  Â  Â  Â  console.log("DEBUG_PAGES_BODY_TO_SEND:", bodyToSend);Â 
Â  Â  Â  Â  Â  Â  Â  console.log("DEBUG_PAGES_FETCH_URL:", `${WORKER_API_BASE}/verify_params`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  // ë°±ì—”ë“œ Workersì˜ '/verify_params' ì—”ë“œí¬ì¸íŠ¸ë¡œ ì¶”ì¶œí•œ ì •ë³´ë¥¼ ì „ì†¡í•˜ì—¬ ì‚¬ìš©ì ê²€ì¦
Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`${WORKER_API_BASE}/verify_params`, {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ userId, chatId, signature }),Â 
Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  const verificationResult = await response.json();

Â  Â  Â  Â  Â  Â  Â  if (verificationResult.ok) {Â  Â  Â  Â // âœ… ê²€ì¦ ì„±ê³µ ì‹œÂ  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  const user = verificationResult.user || {};Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUserId = userId; // ğŸ’¥ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = chatId; // ğŸ’¥ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log(`âœ“ ì¸ì¦ ì™„ë£Œ! ì‚¬ìš©ì ID: ${userId}, ê·¸ë£¹ ID: ${chatId}`);Â Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.style.display = 'none'; // ì ‘ê·¼ ê±°ë¶€ ë©”ì‹œì§€ëŠ” ìˆ¨ê¹€ (í˜¹ì‹œ ì´ˆê¸° display:block ì„¤ì •ë˜ì–´ ìˆì„ ê²½ìš° ëŒ€ë¹„)

Â  Â  Â  Â  Â  Â  Â  Â  Â  // âœ… ê²€ì¦ í†µê³¼ í›„ ë¯¸ë‹ˆì•±ì˜ ì£¼ìš” UI ìš”ì†Œë“¤ì„ ë³´ì´ê²Œ í•¨
Â  Â  Â  Â  Â  Â  Â  Â  Â  headerElement.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  mainContentElement.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  footerNavElement.style.display = 'flex'; // footer-navëŠ” flexë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  goToToday(); // ì˜¤ëŠ˜ ë‚ ì§œ ìŠ¤ì¼€ì¤„ ë¡œë“œ ì‹œì‘
Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  // âŒ ê²€ì¦ ì‹¤íŒ¨ ì‹œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ ì‚¬ìš©ì ê²€ì¦ ì‹¤íŒ¨:', verificationResult.reason);
Â  Â  Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.querySelector('p').textContent = `ğŸš¨ ì¸ì¦ ì‹¤íŒ¨: ${verificationResult.reason}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.style.display = 'block'; // ì ‘ê·¼ ê±°ë¶€ ë©”ì‹œì§€ í™œì„±í™”Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  // window.Telegram.WebApp.close();Â  Â // í…”ë ˆê·¸ë¨ Web App ë‹«ê¸° (ì„ íƒ ì‚¬í•­)
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  console.error('âŒ ì‚¬ìš©ì ê²€ì¦ ì¤‘ í†µì‹  ì˜¤ë¥˜:', error);
Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.querySelector('p').textContent = `ğŸš¨ ì¸ì¦ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`;
Â  Â  Â  Â  Â  Â  Â  accessDeniedDiv.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  // window.Telegram.WebApp.close();
Â  Â  Â  Â  Â  }
          // ğŸ”‘ [START] ì„¤ì • ë²„íŠ¼ í† ê¸€ íŠ¸ë¦¬ê±° ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (DOMì´ ë¡œë“œëœ í›„)
          const currentMonthYearElement = document.getElementById('current-month-year');
          if (currentMonthYearElement) {
              let clickCount = 0;
              let timer = null;
              const requiredClicks = 5;
              const resetTime = 1000;
              
              currentMonthYearElement.addEventListener('click', () => {
                  clickCount++;
                  if (timer) { clearTimeout(timer); }

                  if (clickCount >= requiredClicks) {
                      toggleSettingsVisibility(); // ğŸ’¾ ì •ì˜ëœ í•¨ìˆ˜ í˜¸ì¶œ
                      clickCount = 0;
                      clearTimeout(timer);
                      timer = null;
                      console.log("Secret settings visibility toggled!");
                      return;
                  }

                  timer = setTimeout(() => {
                      if (clickCount > 0) {
                          clickCount = 0;
                          console.log("Click sequence reset.");
                      }
                  }, resetTime);
              });
          }
          // ğŸ”‘ [END] ì„¤ì • ë²„íŠ¼ í† ê¸€ íŠ¸ë¦¬ê±° ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
Â  Â  Â  });

      // ğŸ’¾ [START] ì„¤ì • í† ê¸€ í•¨ìˆ˜ ì •ì˜
      function toggleSettingsVisibility() {
          const footerNav = document.querySelector('.footer-nav');
          // .settings-active í´ë˜ìŠ¤ë¥¼ ì¶”ê°€/ì œê±°í•˜ì—¬ CSS ë¹„ìœ¨ì„ ë³€ê²½í•©ë‹ˆë‹¤.
          footerNav.classList.toggle('settings-active'); 
      }
      // ğŸ’¾ [END] ì„¤ì • í† ê¸€ í•¨ìˆ˜ ì •ì˜
      
Â  Â  Â  // ì›”/ë…„ í—¤ë”ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
Â  Â  Â  function updateMonthHeader() {
Â  Â  Â  Â  Â  const options = { year: 'numeric', month: 'long' };
Â  Â  Â  Â  Â  document.getElementById('current-month-year').textContent = currentDate.toLocaleString('ko-KR', options);
Â  Â  Â  }
Â  Â  Â  // ì›” ë³€ê²½ (ì´ì „ ë‹¬)
Â  Â  Â  function prevMonth() {
Â  Â  Â  Â  Â  currentDate.setMonth(currentDate.getMonth() - 1);
Â  Â  Â  Â  Â  renderSchedule();
Â  Â  Â  Â  Â  showToast(`${currentDate.getFullYear()}ë…„ ${currentDate.getMonth() + 1}ì›”`);
Â  Â  Â  }
Â  Â  Â  // ì›” ë³€ê²½ (ë‹¤ìŒ ë‹¬)
Â  Â  Â  function nextMonth() {
Â  Â  Â  Â  Â  currentDate.setMonth(currentDate.getMonth() + 1);
Â  Â  Â  Â  Â  renderSchedule();
Â  Â  Â  Â  Â  showToast(`${currentDate.getFullYear()}ë…„ ${currentDate.getMonth() + 1}ì›”`);
Â  Â  Â  }
Â  Â  Â  // ì›”ì˜ ë§ˆì§€ë§‰ ë‚ ì§œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
Â  Â  Â  function getDaysInMonth(date) {
Â  Â  Â  Â  Â  return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
Â  Â  Â  }
Â  Â  Â  // ì˜¤ëŠ˜ì˜ ë‚ ì§œ ì¹´ë“œì— ìŠ¤í¬ë¡¤í•©ë‹ˆë‹¤.
Â  Â  Â  function scrollToTodayCard() {
Â  Â  Â  Â  Â  const todayCard = document.querySelector('.schedule-card.today');
Â  Â  Â  Â  Â  const header = document.querySelector('.header');Â 
Â  Â  Â  Â  Â  if (todayCard && header) {
Â  Â  Â  Â  Â  Â  Â  const headerHeight = header.offsetHeight;Â 
Â  Â  Â  Â  Â  Â  Â  const targetScrollY = todayCard.offsetTop - headerHeight - 30;
Â  Â  Â  Â  Â  Â  Â  window.scrollTo({ top: targetScrollY, behavior: 'smooth' });
Â  Â  Â  Â  Â  } else if (todayCard) {
Â  Â  Â  Â  Â  Â  Â  todayCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
Â  Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  // ìŠ¤ì¼€ì¤„ ì¹´ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ğŸ’¥ ë°±ì—”ë“œ ì‘ë‹µ í˜•ì‹ì— ë§ì¶° item.day, item.night1, item.night2ë¡œ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.
Â  Â  Â  function createDutyCard(dayNum, dayName, dateObj, dutyData = null) {
Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  const isToday = dateObj.getDate() === today.getDate() &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dateObj.getMonth() === today.getMonth() &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dateObj.getFullYear() === today.getFullYear();

Â  Â  Â  Â  const isSaturday = dateObj.getDay() === 6;
Â  Â  Â  Â  const isSunday = dateObj.getDay() === 0;

Â  Â  Â  Â  let cardHtml = `<div class="schedule-card${isToday ? ' today' : ''}">`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ì•„ì´ì½˜ ê²°ì •ì„ ìœ„í•œ ë³€ìˆ˜ ì´ˆê¸°í™”
Â  Â  Â  Â  let dutyIconHtml = ''; // ğŸ’¥ ë‚ ì§œ ì˜†ì— í‘œì‹œë  ì•„ì´ì½˜ HTML
Â  Â  Â  Â  if (dutyData && dutyData.type) {
Â  Â  Â  Â  Â  Â  if (dutyData.type === 'ì£¼') {
Â  Â  Â  Â  Â  Â  Â  Â  dutyIconHtml = `<span class="material-icons duty-icon day-icon">wb_sunny</span>`;
Â  Â  Â  Â  Â  Â  } else if (dutyData.type === 'ì•¼') {
Â  Â  Â  Â  Â  Â  Â  Â  dutyIconHtml = `<span class="material-icons duty-icon night-icon">nights_stay</span>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // ğŸ’¥ğŸ’¥ğŸ’¥ ë‚ ì§œ ì˜ì—­ HTML êµ¬ì¡° ë³€ê²½: ì•„ì´ì½˜ì„ card-date ì•ˆì— ë‚ ì§œë³´ë‹¤ ë¨¼ì € ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤. ğŸ’¥ğŸ’¥ğŸ’¥
Â  Â  Â  Â  cardHtml += `
Â  Â  Â  Â  Â  Â  <div class="card-date">
Â  Â  Â  Â  Â  Â  Â  Â  ${dutyIconHtml} Â  Â  Â  Â  Â  Â  Â  Â  <span class="day-num">${dayNum}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="day-name${isSaturday ? ' weekend-sat' : isSunday ? ' weekend-sun' : ''}">${dayName}</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;

Â  Â  Â  Â  // ğŸ’¥ğŸ’¥ğŸ’¥ ìŠ¤ì¼€ì¤„ ë°ì´í„° ì²˜ë¦¬ ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ ğŸ’¥ğŸ’¥ğŸ’¥
Â  Â  Â  Â  if (dutyData && (dutyData.day || dutyData.night1 || dutyData.night2)) {
Â  Â  Â  Â  Â  Â  cardHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-duties">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="duty-col day-duty-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dutyData.day ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${dutyData.day}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="duty-col night-duty-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${(dutyData.night1 || dutyData.night2) ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dutyData.night1 || ''}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${ (dutyData.night1 && dutyData.night2) ? `ã€€` : '' }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dutyData.night2 || ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  cardHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-duties" style="text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #aaa;">${dutyData && dutyData.type === 'ë¹„' ? ' ' : 'ìŠ¤ì¼€ì¤„ ì—†ìŒ'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  Â  Â  cardHtml += `</div>`;
Â  Â  Â  Â  return cardHtml;
Â  Â  Â  }

Â  Â  Â  // ìŠ¤ì¼€ì¤„ì„ ë Œë”ë§í•˜ê³ , í•„ìš” ì‹œ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ìŠ¤í¬ë¡¤í•©ë‹ˆë‹¤.
Â  Â  Â  // ğŸ’¥ currentUserIdì™€ currentChatIdë¥¼ ì‚¬ìš©í•˜ì—¬ ë°±ì—”ë“œ ìš”ì²­ ì‹œ í™œìš©í•©ë‹ˆë‹¤.
Â  Â  Â  // @param {boolean} [scrollToToday=false] ë Œë”ë§ í›„ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ìŠ¤í¬ë¡¤í• ì§€ ì—¬ë¶€
Â  Â  Â  async function renderSchedule(scrollToToday = false) {Â 
Â  Â  Â  Â  Â  // ğŸ’¥ ê²€ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì IDë¼ë©´ ìŠ¤ì¼€ì¤„ ë¡œë“œë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  if (!currentUserId || !currentChatId) { // user ID ë˜ëŠ” chat IDê°€ ì—†ìœ¼ë©´ ìŠ¤ì¼€ì¤„ ë¡œë“œ ì¤‘ë‹¨
Â  Â  Â  Â  Â  Â  Â  console.warn('ì‚¬ìš©ì/ì±„íŒ…ë°© IDê°€ ì—†ì–´ ìŠ¤ì¼€ì¤„ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
Â  Â  Â  Â  Â  Â  Â  document.getElementById('main-content').innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="text-align: center; color: #dc3545; margin-top: 50px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ì‚¬ìš©ì/ì±„íŒ…ë°© ì¸ì¦ì´ í•„ìš”í•˜ê±°ë‚˜ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  updateMonthHeader();
Â  Â  Â  Â  Â  const el = document.getElementById('main-content');
Â  Â  Â  Â  Â  el.innerHTML = '';
Â  Â  Â  Â  Â  const year = currentDate.getFullYear();
Â  Â  Â  Â  Â  const month = currentDate.getMonth() + 1;
Â  Â  Â  Â  Â  const start = `${year}-${String(month).padStart(2,'0')}-01`;
Â  Â  Â  Â  Â  const end = `${year}-${String(month).padStart(2,'0')}-${String(getDaysInMonth(currentDate)).padStart(2,'0')}`;

Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  const res = await fetch(`${WORKER_API_BASE}/api/schedule?start=${start}&end=${end}`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë°±ì—”ë“œì—ì„œ ì‚¬ìš©ìë³„ ìŠ¤ì¼€ì¤„ ë¡œì§ì´ í•„ìš”í•œ ê²½ìš°, userIdì™€ chatIdë¥¼ í—¤ë”ë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'X-User-Id': currentUserId, 'X-Chat-Id': currentChatId }Â 
Â  Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  // ğŸ’¥ğŸ’¥ğŸ’¥ ìŠ¤ì¼€ì¤„ ë¡œë”© ë””ë²„ê¹… ë¡œê·¸ ğŸ’¥ğŸ’¥ğŸ’¥
Â  Â  Â  Â  Â  Â  Â  const rawResponseText = await res.text();
Â  Â  Â  Â  Â  Â  Â  console.log("DEBUG_SCHEDULE_RAW_RESPONSE:", rawResponseText);
Â  Â  Â  Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  let errorMessage = 'ì•Œ ìˆ˜ ì—†ëŠ” ì„œë²„ ì˜¤ë¥˜';
Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorData = JSON.parse(rawResponseText);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = errorData.error || errorData.reason || errorMessage;
Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) { /* JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê·¸ëƒ¥ í…ìŠ¤íŠ¸ ì‚¬ìš© */ }
Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(errorMessage);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(rawResponseText); // rawResponseTextë¥¼ JSONìœ¼ë¡œ íŒŒì‹±
Â  Â  Â  Â  Â  Â  Â  console.log("DEBUG_SCHEDULE_PARSED_DATA:", data); // íŒŒì‹±ëœ ë°ì´í„° í™•ì¸
Â  Â  Â  Â  Â  Â  Â  if (!Array.isArray(data)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(data.error || 'ì˜ˆìƒì¹˜ ëª»í•œ ë°ì´í„° í˜•ì‹: ë°°ì—´ì´ ì•„ë‹˜');
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  // ë Œë”ë§
Â  Â  Â  Â  Â  Â  Â  if (data.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = data.map(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const d = new Date(item.date);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë°±ì—”ë“œ /api/schedule ì‘ë‹µ êµ¬ì¡°ì— ë§ì¶° item.day, item.night1, item.night2 ì…ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dutyDisplayData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  day: item.day,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  night1: item.night1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  night2: item.night2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: item.type // 'ì£¼' 'ì•¼' 'ë¹„' êµ¬ë¶„ì„ ìœ„í•´ typeë„ ì „ë‹¬
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return createDutyCard(d.getDate(), DAYS[d.getDay()], d, dutyDisplayData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  }).join('');
Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `<p style="text-align: center; margin-top: 50px;">í•´ë‹¹ ì›”ì˜ ìŠ¤ì¼€ì¤„ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  if (scrollToToday) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  scrollToTodayCard();
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } catch (error) {Â 
Â  Â  Â  Â  Â  Â  Â  console.error('ìŠ¤ì¼€ì¤„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  const days = getDaysInMonth(currentDate);
Â  Â  Â  Â  Â  Â  Â  let fallbackHtml = '';
Â  Â  Â  Â  Â  Â  Â  for (let i = 1; i <= days; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);
Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ëŠ” dutyDataë¥¼ nullë¡œ ì „ë‹¬í•˜ì—¬ 'ìŠ¤ì¼€ì¤„ ì—†ìŒ' í‘œì‹œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  fallbackHtml += createDutyCard(i, DAYS[date.getDay()], date, null);Â 
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  el.innerHTML = fallbackHtml;Â 
Â  Â  Â  Â  Â  Â  Â  showToast(`ìŠ¤ì¼€ì¤„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (${error.message || "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜"})`);
Â  Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  // 'ì˜¤ëŠ˜' ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ í•¨ìˆ˜
Â  Â  Â  function goToToday() {
Â  Â  Â  Â  Â  currentDate = new Date();Â 
Â  Â  Â  Â  Â  renderSchedule(true); // ìŠ¤í¬ë¡¤ í”Œë˜ê·¸ë¥¼ trueë¡œ ì „ë‹¬
Â  Â  Â  }

Â  Â  Â  async function openSettingsModal() {
Â  Â  Â  Â  document.getElementById('settings-modal').style.display = 'flex';
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(`${WORKER_API_BASE}/api/settings`);
Â  Â  Â  Â  Â  Â  const settings = await res.json();
Â  Â  Â  Â  Â  Â  if (settings.cycle) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('duty-cycle').value = settings.cycle;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (settings.baseDate) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('duty-base-date').value = settings.baseDate.substring(0, 10);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (settings.users && Array.isArray(settings.users)) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('duty-users').value = settings.users.join(' ');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error('Failed to load settings:', e);
Â  Â  Â  Â  Â  Â  showToast('Failed to load settings.');
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  function closeSettingsModal() {
Â  Â  Â  Â  Â  document.getElementById('settings-modal').style.display = 'none';
          // ğŸ’¾ ì„¤ì • ëª¨ë‹¬ì´ ë‹«í ë•Œ settings-active í´ë˜ìŠ¤ë¥¼ ì œê±° (ë²„íŠ¼ì„ ë‹¤ì‹œ ìˆ¨ê¹€)
          const footerNav = document.querySelector('.footer-nav');
          if (footerNav.classList.contains('settings-active')) {
              footerNav.classList.remove('settings-active');
          }
Â  Â  Â  }
Â  Â  Â  async function saveDutyCycle() {
Â  Â  Â  Â  const dutyCycle = document.getElementById('duty-cycle').value;
Â  Â  Â  Â  const dutyBaseDate = document.getElementById('duty-base-date').value;
Â  Â  Â  Â  const dutyUsers = document.getElementById('duty-users').value;
Â  Â  Â  Â  const usersArray = dutyUsers.split(' ').filter(u => u.trim() !== '');

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(`${WORKER_API_BASE}/api/settings`, {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cycle: dutyCycle,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  baseDate: dutyBaseDate,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  users: usersArray
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (res.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast('ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
Â  Â  Â  Â  Â  Â  Â  Â  closeSettingsModal();
Â  Â  Â  Â  Â  Â  Â  Â  renderSchedule(); // ì„¤ì • ë³€ê²½ í›„ ìŠ¤ì¼€ì¤„ ìƒˆë¡œê³ ì¹¨
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const errorData = await res.json();
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ${errorData.error || res.statusText}`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error('Failed to save settings:', e);
Â  Â  Â  Â  Â  Â  showToast('ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â Â 
Â  Â  Â  let toastTimeoutId = null; // íƒ€ì´ë¨¸ IDë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜Â  Â  Â Â 
Â  Â  Â  function showToast(message, duration = 1000) {
Â  Â  Â  Â  Â  let toast = document.getElementById('toast');
Â  Â  Â  Â  Â  if (!toast) {
Â  Â  Â  Â  Â  Â  Â  toast = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  toast.id = 'toast';
Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(toast);
Â  Â  Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  Â  Â  // ğŸ’¥ğŸ’¥ğŸ’¥ ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆë‹¤ë©´ í´ë¦¬ì–´ (í† ìŠ¤íŠ¸ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” ë¬¸ì œ í•´ê²° í•µì‹¬!) ğŸ’¥ğŸ’¥ğŸ’¥
Â  Â  Â  Â  Â  if (toastTimeoutId) {
Â  Â  Â  Â  Â  Â  Â  clearTimeout(toastTimeoutId);
Â  Â  Â  Â  Â  Â  Â  toastTimeoutId = null;
Â  Â  Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  Â  Â  // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ ë° ë³´ì´ë„ë¡ ì„¤ì •
Â  Â  Â  Â  Â  toast.textContent = message;
Â  Â  Â  Â  Â  toast.style.visibility = 'visible'; // ì¦‰ì‹œ ë³´ì´ë„ë¡
Â  Â  Â  Â  Â  toast.style.opacity = '1';Â  Â  Â  Â  Â  // ë¶ˆíˆ¬ëª…í•˜ê²Œ (CSS íŠ¸ëœì§€ì…˜ ì‹œì‘)
Â  Â  Â Â 
Â  Â  Â  Â  Â  // ì§€ì •ëœ ì‹œê°„(duration) í›„ í† ìŠ¤íŠ¸ë¥¼ ì‚¬ë¼ì§€ê²Œ í•˜ëŠ” íƒ€ì´ë¨¸ ì„¤ì •
Â  Â  Â  Â  Â  toastTimeoutId = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  toast.style.opacity = '0'; // íˆ¬ëª…í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤ (CSS íŠ¸ëœì§€ì…˜ ì‹œì‘)
Â  Â  Â  Â  Â  Â  Â  // opacity íŠ¸ëœì§€ì…˜ì´ ì™„ë£Œë  ì‹œê°„ì„ ê¸°ë‹¤ë¦° í›„ ìš”ì†Œë¥¼ ì™„ì „íˆ ìˆ¨ê¹ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  // CSS transitionì˜ durationê³¼ ë™ì¼í•˜ê²Œ ë§ì¶¥ë‹ˆë‹¤. (0.3s = 300ms)
Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì´ ì‹œì ì— opacityê°€ 0ì´ ì•„ë‹ˆë©´ ë‹¤ë¥¸ í† ìŠ¤íŠ¸ê°€ ì‹œì‘ëì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™•ì¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  if (toast.style.opacity === '0') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toast.style.visibility = 'hidden'; // ì™„ì „íˆ ìˆ¨ê¹€
Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  toastTimeoutId = null; // íƒ€ì´ë¨¸ ID ì´ˆê¸°í™”
Â  Â  Â  Â  Â  Â  Â  }, 1000); // CSS transition-duration ê°’ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •
Â  Â  Â  Â  Â  }, duration); // ${duration}ms í›„ì— ì‚¬ë¼ì§€ê¸° ì‹œì‘
Â  Â  Â  }
Â  Â  Â  // ğŸ’¥ğŸ’¥ğŸ’¥ ìŠ¤ì™€ì´í”„ ğŸ’¥ğŸ’¥ğŸ’¥Â  Â  Â Â 
Â  Â  Â  let touchStartX = 0;
Â  Â  Â  const SWIPE_THRESHOLD = 80;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // ìŠ¤ì™€ì´í”„ë¡œ ì¸ì‹í•  ìµœì†Œ ì´ë™ ê±°ë¦¬ (í”½ì…€)Â Â 
Â  Â  Â  const scheduleContainer = document.querySelector('.container');Â Â 
Â  Â  Â  scheduleContainer.addEventListener('touchstart', (e) => {
Â  Â  Â  Â  Â  touchStartX = e.touches[0].clientX; // í„°ì¹˜ ì‹œì‘ ì§€ì ì˜ X ì¢Œí‘œ ì €ì¥
Â  Â  Â  });
Â  Â  Â  scheduleContainer.addEventListener('touchend', (e) => {
Â  Â  Â  Â  Â  const touchEndX = e.changedTouches[0].clientX; // í„°ì¹˜ ë ì§€ì ì˜ X ì¢Œí‘œ
Â  Â  Â  Â  Â  const deltaX = touchEndX - touchStartX; // Xì¶• ì´ë™ ê±°ë¦¬ ê³„ì‚°Â Â 
Â  Â  Â  Â  Â  if (deltaX > SWIPE_THRESHOLD) {
Â  Â  Â  Â  Â  Â  Â  prevMonth(); // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ (ì´ì „ ë‹¬ë¡œ ì´ë™)
Â  Â  Â  Â  Â  } else if (deltaX < -SWIPE_THRESHOLD) {
Â  Â  Â  Â  Â  Â  Â  nextMonth(); // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ (ë‹¤ìŒ ë‹¬ë¡œ ì´ë™)
Â  Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  // ğŸ’¥ğŸ’¥ğŸ’¥ ìŠ¤ì™€ì´í”„ ë ğŸ’¥ğŸ’¥ğŸ’¥Â  Â  Â Â 
Â  Â  </script>
</body>
</html>
